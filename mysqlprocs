DELIMITER | 

drop function SteamToInt|

create function SteamToInt(steamid varchar(64))
RETURNS bigint(64)
BEGIN
	declare authserver int;
	declare authid int;

	set authserver = cast(substr(steamid,9,1) as unsigned integer);
	set authid = cast(substr(steamid,11) as unsigned integer);
	return 76561197960265728+(authid*2)+authserver;
END |

drop function IntToSteam|

create function IntToSteam(communityid bigint(64))
RETURNS varchar(64)
BEGIN
	declare ret varchar(64);
	declare authserver int;
	declare authid bigint;

	set communityid = communityid-76561197960265728;

	set authserver = mod(communityid,2);
	set communityid = communityid-authserver;

	set authid = communityid/2;

	set ret = concat("STEAM_0:",authserver,":",authid);
	return ret;
END |

DELIMITER ;

DROP TABLE servers;
DROP TABLE players;
DROP TABLE player_weapons;
DROP TABLE player_events;

CREATE TABLE servers (
  server_id int(11) NOT NULL auto_increment
  ,server_ip varchar(16) default NULL
  ,server_port int(11) default NULL
  ,PRIMARY KEY  (server_id)
  ,UNIQUE KEY server_ip (server_ip,server_port)
) ENGINE=InnoDB;

CREATE TABLE players (
  server_id int(11) NOT NULL default '0',
  ,player_id bigint(20) NOT NULL default '0'
  ,lastconnect datetime default NULL
  ,kills int(11) default NULL
  ,deaths int(11) default NULL
  ,suicides int(11) default NULL
  ,PRIMARY KEY  (server_id,player_id)
) ENGINE=InnoDB;

CREATE TABLE player_weapons (
  server_id int(11) NOT NULL default '0'
  ,player_id bigint(20) NOT NULL default '0'
  ,weapon_name varchar(64) NOT NULL default ''
  ,kills int(11) default NULL
  ,headshots int(11) default NULL
  ,damage int(11) default NULL
  ,tks int(11) default NULL
  ,PRIMARY KEY  (server_id,player_id,weapon_name)
) ENGINE=InnoDB;

CREATE TABLE player_events (
  server_id int(11) NOT NULL default '0'
  ,player_id bigint(20) NOT NULL default '0'
  ,event_name varchar(64) NOT NULL default ''
  ,triggercount int(11) default NULL
  ,PRIMARY KEY  (server_id,player_id,event_name)
) ENGINE=InnoDB;
